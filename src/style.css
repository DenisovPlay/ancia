@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --traffic-light-offset: 78px;
  --app-font-stack: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans", Ubuntu, Cantarell, "Helvetica Neue", Arial, sans-serif;
  --app-mono-font-stack: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}

* { box-sizing: border-box; }
html, body { margin: 0; width: 100%; height: 100%; }

body {
  position: relative;
  overflow: hidden;
  background: #09090b;
  font-family: var(--app-font-stack);
}

/* ── App shell entrance ──────────────────────────────────────── */

#app-shell {
  opacity: 0;
  transition: opacity 220ms ease;
}

body.app-shell-visible #app-shell {
  opacity: 1;
}

/* ── User-select ─────────────────────────────────────────────── */

body, body * {
  -webkit-user-select: none;
  user-select: none;
}

input, textarea,
[contenteditable="true"], [contenteditable="true"] *,
.message-content, .message-content *,
.message-meta, .message-meta *,
.tool-call-card, .tool-call-card *,
.tool-call-details-inner, .tool-call-details-inner * {
  -webkit-user-select: text;
  user-select: text;
}

/* ── Preloader ───────────────────────────────────────────────── */

.app-preloader {
  position: fixed;
  inset: 0;
  z-index: 140;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 12px;
  background: rgb(9 9 11 / 0.95);
  backdrop-filter: blur(8px);
  opacity: 1;
  transition: opacity 200ms ease, visibility 200ms ease;
}

body.app-ready .app-preloader {
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
}

.app-preloader__brand {
  margin: 4px 0 2px;
  font-size: 13px;
  letter-spacing: 0.28em;
  font-weight: 700;
  color: rgb(244 244 245 / 0.9);
  text-transform: uppercase;
}

.app-preloader__label {
  margin: 0;
  font-size: 11px;
  letter-spacing: 0.06em;
  color: rgb(161 161 170);
}

.app-preloader__progress-track {
  position: relative;
  width: min(280px, 60vw);
  height: 2px;
  border-radius: 2px;
  background: rgb(63 63 70 / 0.5);
  overflow: hidden;
}

.app-preloader__progress-fill {
  width: 34%;
  height: 100%;
  border-radius: inherit;
  background: rgb(161 161 170);
  transition: width 200ms ease;
}

.app-preloader__progress-fill[data-mode="indeterminate"] {
  animation: loader-indeterminate 1.2s ease-in-out infinite;
}

/* ── Canvas & noise layer ────────────────────────────────────── */

#liquid-canvas {
  position: fixed;
  inset: 0;
  z-index: 0;
  width: 100%;
  height: 100%;
  display: block;
}

.noise-layer {
  position: fixed;
  inset: 0;
  z-index: 1;
  pointer-events: none;
  opacity: 0.06;
  background-image:
    radial-gradient(circle at 22% 28%, rgb(255 255 255 / 14%) 0.4px, transparent 0.6px),
    radial-gradient(circle at 78% 56%, rgb(255 255 255 / 10%) 0.35px, transparent 0.55px);
  background-size: 14px 14px, 10px 10px;
}

/* ── Icon sizing ─────────────────────────────────────────────── */

.ui-icon {
  width: 1rem;
  height: 1rem;
  display: inline-block;
  flex-shrink: 0;
  stroke: currentColor;
  stroke-width: 1.8;
  stroke-linecap: round;
  stroke-linejoin: round;
  vertical-align: middle;
}

.ui-icon-lg  { width: 1.25rem; height: 1.25rem; }
.ui-icon-nav { width: 1.5rem;  height: 1.5rem;  }
.ui-icon-xl  { width: 2.75rem; height: 2.75rem; }

.icon-button {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.4rem;
}

/* ── Navigation: route icons ─────────────────────────────────── */

.route-icon {
  transition: transform 170ms ease, background 150ms ease, color 150ms ease, border-color 150ms ease;
  transform-origin: center;
}

.route-icon[data-active="true"] {
  background: rgb(39 39 42 / 0.7);
  color: rgb(228 228 231);
  border-color: rgb(63 63 70 / 0.6);
}

.route-icon[data-active="true"] .route-icon__label {
  opacity: 1;
}

.route-icon[data-active="false"] {
  color: rgb(82 82 91);
  background: transparent;
}

.route-icon[data-active="false"]:hover {
  color: rgb(161 161 170);
  background: rgb(39 39 42 / 0.4);
}

.route-icon__label {
  font-size: 8.5px;
  letter-spacing: 0.04em;
  font-weight: 500;
  text-transform: uppercase;
  line-height: 1;
  opacity: 0.6;
  user-select: none;
  transition: opacity 150ms ease;
}

/* ── Route pills ─────────────────────────────────────────────── */

.route-pill {
  transition: transform 170ms ease, background 150ms ease, color 150ms ease, border-color 150ms ease;
  transform-origin: center;
}

.route-pill[data-active="true"] {
  color: rgb(244 244 245);
  background: rgb(63 63 70 / 0.6);
  border-color: rgb(82 82 91 / 0.6);
}

.route-pill[data-active="false"] {
  color: rgb(161 161 170);
  background: transparent;
  border-color: rgb(63 63 70 / 0.4);
}

.route-pill[data-active="false"]:hover {
  color: rgb(228 228 231);
  background: rgb(39 39 42 / 0.5);
}

/* ── Page transitions ────────────────────────────────────────── */

.route-page { opacity: 1; }

.route-page.route-page-enter {
  position: absolute;
  inset: 0;
  animation: fade-in 160ms ease;
}

.route-page.route-page-leave {
  position: absolute;
  inset: 0;
  opacity: 0;
  pointer-events: none;
  transition: opacity 160ms ease;
}

.settings-section { opacity: 1; }

.settings-section.settings-section-enter {
  animation: fade-in 160ms ease;
}

.settings-section.settings-section-leave {
  opacity: 0;
  pointer-events: none;
  transition: opacity 160ms ease;
}

/* ── Cards ───────────────────────────────────────────────────── */

.plugin-card, .model-card {
  transition: border-color 150ms ease;
}

.plugin-card:hover, .model-card:hover {
  border-color: rgb(82 82 91 / 0.7);
}

.animate-rise-in {
  animation: fade-in 180ms ease both;
}

/* ── Composer ────────────────────────────────────────────────── */

#composer-form {
  transition: border-color 150ms ease;
}

#composer-form:focus-within {
  border-color: rgb(82 82 91 / 0.7);
}

#composer-input {
  color: rgb(228 228 231);
}

#composer-input::placeholder {
  color: rgb(82 82 91);
}

.composer-context-indicator {
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 0.45rem;
  padding: 0.16rem 0.45rem 0.16rem 0.2rem;
  border-radius: 0.5rem;
  border: 1px solid rgb(63 63 70);
  background: rgb(24 24 27 / 0.75);
  color: rgb(161 161 170);
  opacity: 1;
  cursor: default;
}

#composer-context-indicator:disabled {
  opacity: 1;
  cursor: default;
}

.composer-context-ring {
  --ctx-ratio: 0;
  width: 1.05rem;
  height: 1.05rem;
  border-radius: 9999px;
  background:
    conic-gradient(
      rgb(74 222 128) calc(var(--ctx-ratio) * 1%),
      rgb(63 63 70 / 0.5) 0
    );
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.composer-context-ring__inner {
  width: 0.63rem;
  height: 0.63rem;
  border-radius: 9999px;
  background: rgb(9 9 11);
  border: 1px solid rgb(63 63 70 / 0.85);
}

.composer-context-label {
  font-family: var(--app-mono-font-stack);
  font-size: 0.65rem;
  letter-spacing: 0.02em;
  color: inherit;
}

.composer-context-popover {
  position: absolute;
  right: 0;
  bottom: calc(100% + 0.42rem);
  z-index: 24;
  min-width: 14.5rem;
  border-radius: 0.6rem;
  border: 1px solid rgb(63 63 70);
  background: rgb(9 9 11 / 0.98);
  box-shadow: 0 12px 28px rgb(0 0 0 / 0.45);
  padding: 0.5rem 0.6rem;
  display: grid;
  gap: 0.24rem;
  opacity: 0;
  transform: translateY(4px);
  pointer-events: none;
  transition: opacity 120ms ease, transform 120ms ease;
}

.composer-context-popover[aria-hidden="true"] {
  display: none;
}

.composer-context-popover::after {
  content: "";
  position: absolute;
  right: 0.7rem;
  top: 100%;
  width: 0.45rem;
  height: 0.45rem;
  border-right: 1px solid rgb(63 63 70);
  border-bottom: 1px solid rgb(63 63 70);
  background: rgb(9 9 11 / 0.98);
  transform: rotate(45deg) translateY(-2px);
}

.composer-context-popover__title {
  font-size: 0.6rem;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: rgb(113 113 122);
}

.composer-context-popover__row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.6rem;
}

.composer-context-popover__key {
  font-size: 0.7rem;
  color: rgb(161 161 170);
}

.composer-context-popover__value {
  font-family: var(--app-mono-font-stack);
  font-size: 0.7rem;
  color: rgb(212 212 216);
}

#composer-context-indicator:hover .composer-context-popover,
#composer-context-indicator:focus-visible .composer-context-popover {
  opacity: 1;
  transform: translateY(0);
}

#composer-context-indicator[data-level="warn"] {
  border-color: rgb(245 158 11 / 0.45);
  color: rgb(251 191 36);
}

#composer-context-indicator[data-level="warn"] .composer-context-ring {
  background:
    conic-gradient(
      rgb(251 191 36) calc(var(--ctx-ratio) * 1%),
      rgb(63 63 70 / 0.5) 0
    );
}

#composer-context-indicator[data-level="critical"] {
  border-color: rgb(248 113 113 / 0.45);
  color: rgb(248 113 113);
}

#composer-context-indicator[data-level="critical"] .composer-context-ring {
  background:
    conic-gradient(
      rgb(248 113 113) calc(var(--ctx-ratio) * 1%),
      rgb(63 63 70 / 0.5) 0
    );
}

#composer-context-indicator[data-level="off"] {
  color: rgb(113 113 122);
}

#composer-context-indicator[data-level="off"] .composer-context-ring {
  background: rgb(63 63 70 / 0.45);
}

#composer-context-indicator[data-loading="true"] {
  border-style: dashed;
}

#composer-context-indicator[data-loading="true"] .composer-context-ring {
  animation: spin 0.92s linear infinite;
}

#composer-context-indicator[data-loading="true"] .composer-context-label {
  opacity: 0.86;
}

/* ── Panels ──────────────────────────────────────────────────── */

#panel-left, #panel-right, #plugin-aside, #settings-aside {
  will-change: transform, opacity;
}

/* ── Tauri drag ──────────────────────────────────────────────── */

.drag-region { user-select: none; }

[data-tauri-drag-region] {
  -webkit-app-region: drag;
  cursor: default;
}

.no-drag, .no-drag * { -webkit-app-region: no-drag; }

button, input, textarea, select, a {
  -webkit-app-region: no-drag;
}

/* ── Form elements ───────────────────────────────────────────── */

select:not([multiple]) {
  -webkit-appearance: none !important;
  appearance: none !important;
  padding-right: 2.4rem !important;
  background-image:
    linear-gradient(45deg, transparent 50%, rgb(113 113 122) 50%),
    linear-gradient(135deg, rgb(113 113 122) 50%, transparent 50%);
  background-repeat: no-repeat;
  background-position:
    calc(100% - 16px) calc(50% + 1px),
    calc(100% - 11px) calc(50% + 1px);
  background-size: 5px 5px, 5px 5px;
  color-scheme: dark;
}

select option {
  color: rgb(244 244 245);
  background-color: rgb(24 24 27);
}

button:disabled, input:disabled, textarea:disabled, select:disabled {
  cursor: not-allowed;
  opacity: 0.5;
}

button:focus-visible, input:focus-visible, textarea:focus-visible,
select:focus-visible, a:focus-visible {
  outline: 1px solid rgb(113 113 122 / 0.6);
  outline-offset: 2px;
}

.field-invalid {
  border-color: rgb(239 68 68 / 0.6) !important;
}

/* ── Toasts ──────────────────────────────────────────────────── */

.toast-region {
  position: fixed;
  right: 12px;
  bottom: 12px;
  z-index: 360;
  display: flex;
  max-width: min(400px, calc(100vw - 20px));
  flex-direction: column;
  gap: 6px;
  pointer-events: none;
}

.toast-item {
  border-radius: 10px;
  border: 1px solid rgb(63 63 70);
  background: rgb(24 24 27 / 0.95);
  padding: 10px 12px;
  color: rgb(228 228 231);
  backdrop-filter: blur(8px);
  pointer-events: auto;
  animation: fade-in 150ms ease;
}

.toast-item[data-tone="success"] { border-color: rgb(34 197 94 / 0.4); }
.toast-item[data-tone="error"]   { border-color: rgb(239 68 68 / 0.4); }
.toast-item[data-tone="warning"] { border-color: rgb(245 158 11 / 0.4); }

.toast-item.toast-item-leave {
  animation: fade-out 120ms ease forwards;
}

.toast-item__title {
  margin: 0;
  font-size: 10px;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: rgb(113 113 122);
}

.toast-item__body {
  margin: 2px 0 0;
  font-size: 13px;
  line-height: 1.35;
  color: rgb(228 228 231);
}

/* ── Context menu ────────────────────────────────────────────── */

.context-menu {
  position: fixed;
  z-index: 170;
  min-width: 200px;
  max-width: min(280px, calc(100vw - 18px));
  display: grid;
  gap: 2px;
  padding: 4px;
  border-radius: 10px;
  border: 1px solid rgb(63 63 70);
  background: rgb(24 24 27 / 0.97);
  backdrop-filter: blur(12px);
  opacity: 0;
  pointer-events: none;
  transition: opacity 120ms ease;
}

.context-menu.is-open {
  opacity: 1;
  pointer-events: auto;
}

.context-menu.is-closing {
  opacity: 0;
  pointer-events: none;
}

.context-menu.hidden { display: none; }

.context-menu__item {
  width: 100%;
  border: 0;
  border-radius: 6px;
  padding: 6px 8px;
  font-size: 13px;
  line-height: 1.3;
  text-align: left;
  color: rgb(212 212 216);
  background: transparent;
  transition: background 100ms ease;
}

.context-menu.is-open .context-menu__item {
  animation: fade-in 100ms ease both;
  animation-delay: calc(var(--context-item-index, 0) * 12ms);
}

.context-menu__item:hover { background: rgb(63 63 70 / 0.6); }

.context-menu__item[data-tone="danger"] { color: rgb(252 165 165); }
.context-menu__item[data-tone="danger"]:hover {
  color: rgb(254 226 226);
  background: rgb(127 29 29 / 0.5);
}

.context-menu__divider {
  height: 1px;
  margin: 2px 0;
  background: rgb(63 63 70 / 0.6);
}

/* ── Modal overlays ──────────────────────────────────────────── */

.app-modal-overlay {
  position: fixed;
  inset: 2.5rem 0 0;
  display: grid;
  place-items: center;
  padding: clamp(10px, 2vw, 24px);
  background: rgb(0 0 0 / 0.6);
  backdrop-filter: blur(4px);
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transition: opacity 200ms ease, visibility 200ms step-end;
}

.app-modal-overlay.hidden { display: none; }

.app-modal-overlay.is-open {
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
  transition: opacity 200ms ease, visibility 200ms step-start;
}

.app-modal-overlay.is-closing {
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
}

.action-dialog-overlay { z-index: 176; }

.action-dialog {
  width: min(420px, 100%);
  border-radius: 12px;
  border: 1px solid rgb(63 63 70);
  background: rgb(18 18 20 / 0.98);
  padding: 16px;
  display: grid;
  gap: 10px;
  opacity: 0;
  transform: translateY(8px);
  transition: transform 200ms ease, opacity 180ms ease;
}

.action-dialog-overlay.is-open .action-dialog {
  opacity: 1;
  transform: translateY(0);
}

.action-dialog-overlay.is-closing .action-dialog {
  opacity: 0;
  transform: translateY(4px);
}

.action-dialog__title {
  margin: 0;
  font-size: 14px;
  font-weight: 600;
  color: rgb(244 244 245);
}

.action-dialog__message {
  margin: 0;
  font-size: 13px;
  line-height: 1.45;
  color: rgb(161 161 170);
}

.action-dialog__input-wrap { display: block; }
.action-dialog__input-wrap.hidden { display: none; }

.action-dialog__input {
  width: 100%;
  border-radius: 8px;
  border: 1px solid rgb(63 63 70);
  background: rgb(9 9 11);
  color: rgb(244 244 245);
  padding: 8px 10px;
  font-size: 13px;
  outline: none;
  transition: border-color 120ms ease;
}

.action-dialog__input:focus {
  border-color: rgb(113 113 122);
}

.action-dialog__actions {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 8px;
}

.action-dialog__confirm-danger {
  color: rgb(252 165 165) !important;
  border-color: rgb(239 68 68 / 0.4) !important;
  background: rgb(127 29 29 / 0.6) !important;
}

/* ── Onboarding ──────────────────────────────────────────────── */

.onboarding-overlay {
  position: fixed;
  inset: 2.5rem 0 0;
  z-index: 130;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: clamp(14px, 3vw, 32px);
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transition: opacity 200ms ease, visibility 200ms step-end;
}

.onboarding-overlay.is-open {
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
  transition: opacity 200ms ease, visibility 200ms step-start;
}

.onboarding-shell {
  position: relative;
  width: min(440px, 100%);
  opacity: 0;
  transform: translateY(10px);
  transition: transform 250ms ease, opacity 200ms ease;
}

.onboarding-overlay.is-open .onboarding-shell {
  opacity: 1;
  transform: translateY(0);
}

.onboarding-step { width: 100%; }

.onboarding-dot {
  width: 6px;
  height: 6px;
  border-radius: 99px;
  background: rgb(63 63 70);
  transition: width 180ms ease, background 180ms ease;
}

.onboarding-dot[data-active="true"] {
  width: 18px;
  background: rgb(161 161 170);
}

.onboarding-step.onboarding-step-enter-forward {
  animation: slide-in-right 180ms ease;
}

.onboarding-step.onboarding-step-enter-back {
  animation: slide-in-left 180ms ease;
}

body.onboarding-open #ui-toast-region { z-index: 360; }

/* ── Platform (Tauri) ────────────────────────────────────────── */

body[data-os="macos"] #titlebar {
  padding-top: max(env(safe-area-inset-top), 0px);
}

body[data-os="macos"] .titlebar-left {
  padding-left: calc(var(--traffic-light-offset) + env(safe-area-inset-left));
}

@media (max-width: 1023px) {
  body[data-os="macos"] .titlebar-left { padding-left: 68px; }
}

body[data-os="windows"] #titlebar { padding-top: 0; }
body[data-os="windows"] .titlebar-left { padding-left: 12px; }

/* ── Chat scroll ─────────────────────────────────────────────── */

.chat-scroll {
  scrollbar-width: thin;
  scrollbar-color: rgb(63 63 70) transparent;
}

.chat-scroll::-webkit-scrollbar { width: 6px; }
.chat-scroll::-webkit-scrollbar-track { background: transparent; }
.chat-scroll::-webkit-scrollbar-thumb {
  border-radius: 3px;
  background-color: rgb(63 63 70);
}

/* ── Chat stream switch ──────────────────────────────────────── */

#chat-stream {
  transition: opacity 150ms ease;
}

#chat-stream.chat-stream-switch-out { opacity: 0; }
#chat-stream.chat-stream-switch-in  { opacity: 1; }

/* ── Session item feedback ───────────────────────────────────── */

.session-item-activated {
  animation: session-item-activate 240ms ease;
}

/* ── Chat empty state ────────────────────────────────────────── */

.chat-empty-state {
  min-height: min(46vh, 400px);
  display: grid;
  place-items: center;
  padding: clamp(48px, 10vh, 100px) 16px;
}

.chat-empty-state__title {
  margin: 0;
  text-align: center;
  font-size: clamp(1.3rem, 3.2vw, 2rem);
  font-weight: 600;
  color: rgb(161 161 170 / 0.8);
}

/* ── State dots (no glow — strict) ───────────────────────────── */

.status-dot {
  width: 7px;
  height: 7px;
  border-radius: 99px;
  background: #34d399;
}

.state-dot {
  width: 6px;
  height: 6px;
  border-radius: 99px;
  background: #71717a;
  transition: background 200ms ease;
}

body[data-mood="thinking"] .state-dot,
body[data-mood="waiting"] .state-dot { background: #facc15; }

body[data-mood="success"] .state-dot,
body[data-mood="friendly"] .state-dot { background: #22c55e; }

body[data-mood="planning"] .state-dot,
body[data-mood="coding"] .state-dot,
body[data-mood="researching"] .state-dot { background: #38bdf8; }

body[data-mood="warning"] .state-dot { background: #f59e0b; }
body[data-mood="offline"] .state-dot { background: #64748b; }

body[data-mood="creative"] .state-dot,
body[data-mood="route_models"] .state-dot,
body[data-mood="route_chat"] .state-dot { background: #a78bfa; }

body[data-mood="route_plugins"] .state-dot { background: #2dd4bf; }
body[data-mood="route_settings"] .state-dot { background: #60a5fa; }

body[data-mood="error"] .state-dot,
body[data-mood="aggression"] .state-dot { background: #ef4444; }

/* ── Messages ────────────────────────────────────────────────── */

.message-row {
  display: flex;
  align-items: flex-end;
}

.message-row[data-role="user"] { justify-content: flex-end; }

.message-row[data-role="tool"] {
  flex-direction: column;
  align-items: flex-start;
  max-width: min(48rem, 92%);
}

.message-content {
  min-width: 0;
  max-width: min(48rem, 92%);
  border-radius: 10px;
  padding: 0.65rem 0.85rem;
}

.message-content-assistant {
  background: transparent;
  border: 1px solid transparent;
  color: rgb(212 212 216);
  padding-left: 0;
  padding-right: 0;
}

.message-content-user {
  border: 1px solid rgb(63 63 70);
  background: rgb(39 39 42 / 0.5);
  border-radius: 10px 10px 4px 10px;
}

.message-content-tool {
  border: none;
  background: transparent;
  padding: 0;
}

.message-body {
  min-width: 0;
  color: rgb(228 228 231);
  overflow-wrap: anywhere;
  word-break: break-word;
}

.message-body > *:first-child { margin-top: 0; }
.message-body > *:last-child  { margin-bottom: 0; }
.message-body p { margin: 0.35rem 0; }

.message-body h1, .message-body h2, .message-body h3, .message-body h4 {
  margin: 0.5rem 0 0.3rem;
  font-weight: 600;
  letter-spacing: -0.01em;
}

.message-body h1 { font-size: 1.05rem; }
.message-body h2 { font-size: 1rem; }
.message-body h3, .message-body h4 { font-size: 0.93rem; }

.message-body ul, .message-body ol {
  margin: 0.35rem 0;
  padding-left: 1.1rem;
}

.message-body li { margin: 0.12rem 0; }

.message-body blockquote {
  margin: 0.4rem 0;
  border-left: 2px solid rgb(63 63 70);
  padding-left: 0.65rem;
  color: rgb(161 161 170);
}

.message-body .message-divider {
  margin: 0.5rem 0;
  border: 0;
  border-top: 1px solid rgb(63 63 70 / 0.5);
}

.message-body a {
  color: rgb(147 197 253);
  text-decoration: underline;
  text-underline-offset: 2px;
}

/* ── Composer attachments ────────────────────────────────────── */

#composer-attachments-list {
  flex-wrap: wrap;
  gap: 0.3rem;
  padding: 0.1rem 0;
}

.composer-attachment-card {
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
  height: 1.75rem;
  max-width: 12rem;
  padding: 0 0.4rem 0 0.25rem;
  border-radius: 6px;
  border: 1px solid rgb(63 63 70);
  background: rgb(39 39 42 / 0.7);
  flex-shrink: 0;
  transition: border-color 0.12s;
}

.composer-attachment-card:hover { border-color: rgb(82 82 91); }

.composer-attachment-card__preview {
  width: 1.3rem; min-width: 1.3rem; height: 1.3rem;
  border-radius: 4px;
  overflow: hidden;
  border: 1px solid rgb(63 63 70);
  background: rgb(9 9 11);
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}

.composer-attachment-card__image { width: 100%; height: 100%; object-fit: cover; }
.composer-attachment-card__icon { width: 0.75rem; height: 0.75rem; color: rgb(113 113 122); }

.composer-attachment-card__content {
  flex: 1; min-width: 0;
  display: flex; flex-direction: column; justify-content: center;
}

.composer-attachment-card__name {
  margin: 0; font-size: 0.7rem; line-height: 1.2;
  color: rgb(212 212 216);
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}

.composer-attachment-card__meta { display: none; }
.composer-attachment-card__text { display: none; }

.composer-attachment-card__remove {
  flex-shrink: 0;
  width: 1rem !important; height: 1rem !important; min-width: 1rem !important;
  border-radius: 4px !important; border: none !important;
  background: transparent !important;
  display: flex; align-items: center; justify-content: center;
  padding: 0; color: rgb(113 113 122);
  transition: color 0.1s;
}

.composer-attachment-card__remove:hover { color: rgb(212 212 216); }
.composer-attachment-card__remove svg { width: 0.55rem; height: 0.55rem; }

/* ── Message attachments ─────────────────────────────────────── */

.message-attach-group {
  display: flex; flex-direction: column; align-items: flex-end;
  max-width: min(48rem, 92%);
}

.message-attachments {
  display: flex; flex-wrap: wrap; gap: 0.25rem; margin-bottom: 0.35rem;
}

.message-row[data-role="user"] .message-attachments { justify-content: flex-end; }

.message-attachment {
  display: inline-flex; align-items: center; gap: 0.25rem;
  height: 1.4rem; max-width: 9rem;
  padding: 0 0.4rem 0 0.2rem;
  border-radius: 4px;
  border: 1px solid rgb(63 63 70 / 0.5);
  background: rgb(39 39 42 / 0.4);
  flex-shrink: 0;
}

.message-attachment__preview {
  width: 1rem; min-width: 1rem; height: 1rem;
  border-radius: 3px; overflow: hidden;
  border: 1px solid rgb(63 63 70);
  background: rgb(9 9 11);
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}

.message-attachment__image { width: 100%; height: 100%; object-fit: cover; }

.message-attachment__badge {
  display: inline-flex; align-items: center; justify-content: center;
  padding: 0 0.2rem; border-radius: 3px;
  min-width: 1rem; height: 1rem;
  background: rgb(63 63 70 / 0.5);
  font-size: 0.48rem; line-height: 1; letter-spacing: 0.04em;
  text-transform: uppercase; color: rgb(161 161 170);
  overflow: hidden; white-space: nowrap; flex-shrink: 0;
}

.message-attachment__content { min-width: 0; flex: 1; display: flex; align-items: center; }

.message-attachment__name {
  margin: 0; font-size: 0.65rem; line-height: 1;
  color: rgb(161 161 170);
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}

.message-attachment__meta { display: none; }
.message-attachment__excerpt { display: none; }

/* ── Code blocks ─────────────────────────────────────────────── */

.message-inline-code {
  border-radius: 4px;
  border: 1px solid rgb(63 63 70);
  background: rgb(24 24 27 / 0.6);
  padding: 0.05rem 0.3rem;
  font-size: 0.82em;
  font-family: var(--app-mono-font-stack);
}

.hljs { background: transparent !important; padding: 0 !important; }

.message-code-block {
  margin: 0.5rem 0;
  border-radius: 8px;
  border: 1px solid rgb(63 63 70);
  background: rgb(9 9 11 / 0.85);
  overflow: hidden;
}

.message-code-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.5rem;
  padding: 0.3rem 0.5rem 0.3rem 0.75rem;
  border-bottom: 1px solid rgb(63 63 70 / 0.6);
  background: rgb(24 24 27 / 0.5);
}

.message-code-lang {
  font-size: 11px;
  font-family: var(--app-mono-font-stack);
  color: rgb(113 113 122);
  text-transform: lowercase;
  letter-spacing: 0.02em;
  flex: 1;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.message-code-copy {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 1.5rem;
  height: 1.5rem;
  border-radius: 5px;
  border: none;
  background: transparent;
  color: rgb(113 113 122);
  cursor: pointer;
  flex-shrink: 0;
  transition: color 120ms ease, background 120ms ease;
  padding: 0;
}

.message-code-copy:hover {
  color: rgb(212 212 216);
  background: rgb(63 63 70 / 0.5);
}

.message-code-copy--done {
  color: rgb(74 222 128) !important;
}

.message-code {
  display: block;
  white-space: pre;
  font-size: 12px;
  line-height: 1.6;
  font-family: var(--app-mono-font-stack);
  padding: 0.65rem 0.75rem;
  overflow-x: auto;
}

.message-thinking {
  margin: 0.4rem 0;
  border-radius: 8px;
  border: 1px solid rgb(63 63 70);
  background: rgb(24 24 27 / 0.5);
  padding: 0.35rem 0.5rem;
}

.message-thinking > summary {
  cursor: pointer;
  font-size: 11px;
  color: rgb(113 113 122);
}

.message-thinking__body { margin-top: 0.4rem; }

.message-math { color: rgb(212 212 216); }

.message-math-inline {
  display: inline-block;
  vertical-align: middle;
  border-radius: 4px;
  border: 1px solid rgb(63 63 70);
  background: rgb(39 39 42 / 0.5);
  padding: 0.05rem 0.3rem;
  line-height: 1;
  font-size: 0.93em;
}

.message-math-inline .katex {
  font-size: 1em;
  line-height: 1;
}

.message-math-inline .katex-html {
  white-space: nowrap;
}

.message-math-block {
  margin: 0.45rem 0;
  border-radius: 8px;
  border: 1px solid rgb(63 63 70);
  background: rgb(24 24 27 / 0.6);
  padding: 0.55rem 0.7rem;
  overflow-x: auto;
}

.message-math-block .katex-display {
  margin: 0;
  text-align: left;
}

.message-math-block .katex {
  font-size: 1em;
}

/* ── Tool calls ──────────────────────────────────────────────── */

.tool-call-card {
  width: 100%; min-width: 0;
  display: flex; align-items: center; gap: 0.5rem;
  padding: 0.4rem 0.5rem;
  border-radius: 8px;
  border: 1px solid rgb(63 63 70 / 0.5);
  background: rgb(24 24 27 / 0.5);
}

.tool-call-status-icon {
  display: flex; align-items: center; justify-content: center;
  width: 1.5rem; height: 1.5rem;
  border-radius: 6px; flex-shrink: 0;
  background: rgb(39 39 42 / 0.6);
}

.tool-status-running { color: rgb(96 165 250); }
.tool-status-ok      { color: rgb(74 222 128); }
.tool-status-warning { color: rgb(251 191 36); }
.tool-status-error   { color: rgb(248 113 113); }

.tool-spinner { animation: spin 0.85s linear infinite; }

.tool-call-info {
  flex: 1; min-width: 0;
  display: flex; flex-direction: column; gap: 0.05rem;
}

.tool-call-head {
  min-width: 0;
  display: flex;
  align-items: center;
  gap: 0.4rem;
}

.tool-call-label {
  min-width: 0; margin: 0;
  display: inline-flex; align-items: center; gap: 0.5rem;
  font-size: 12px; line-height: 1.4; color: rgb(212 212 216);
}

.tool-call-pill {
  font-family: var(--app-mono-font-stack);
  font-size: 10px; letter-spacing: 0.06em;
  text-transform: uppercase; color: rgb(147 197 253 / 0.8);
}

.tool-call-name {
  min-width: 0; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;
  font-size: 12px; color: rgb(212 212 216); line-height: 1.4;
}

.tool-call-badge {
  flex-shrink: 0;
  border-radius: 999px;
  border: 1px solid rgb(82 82 91 / 0.7);
  background: rgb(39 39 42 / 0.55);
  padding: 0.04rem 0.34rem;
  font-family: var(--app-mono-font-stack);
  font-size: 10px;
  line-height: 1.25;
  letter-spacing: 0.01em;
  color: rgb(161 161 170);
}

.tool-call-badge--warning {
  border-color: rgb(245 158 11 / 0.5);
  background: rgb(113 63 18 / 0.3);
  color: rgb(251 191 36);
}

.tool-call-badge--error {
  border-color: rgb(239 68 68 / 0.5);
  background: rgb(127 29 29 / 0.32);
  color: rgb(252 165 165);
}

.tool-call-badge--success {
  border-color: rgb(34 197 94 / 0.45);
  background: rgb(20 83 45 / 0.28);
  color: rgb(134 239 172);
}

.tool-call-badge--info {
  border-color: rgb(96 165 250 / 0.45);
  background: rgb(30 58 138 / 0.24);
  color: rgb(147 197 253);
}

.tool-call-query {
  font-size: 11px; color: rgb(113 113 122);
  overflow: hidden; white-space: nowrap; text-overflow: ellipsis; line-height: 1.3;
}

.tool-call-details {
  display: grid; grid-template-rows: 0fr;
  opacity: 0;
  transition: grid-template-rows 0.2s ease, opacity 0.15s ease;
  pointer-events: none; width: 100%; margin-bottom: -1.5rem;
}

.tool-call-details.is-open {
  grid-template-rows: 1fr;
  opacity: 1;
  pointer-events: auto;
  margin-bottom: 0;
}

.tool-call-details-inner {
  min-height: 0; overflow: hidden;
  border: 1px solid rgb(63 63 70 / 0.5);
  border-radius: 8px;
  background: rgb(24 24 27 / 0.3);
  padding: 0.4rem 0.6rem;
  margin-top: 0.3rem;
}

.tool-expand-btn .ui-icon { transition: transform 0.18s ease; }
.tool-expand-btn[aria-expanded="true"] .ui-icon { transform: rotate(180deg); }

/* ── Message meta & pending ──────────────────────────────────── */

.message-meta {
  margin-top: 0.3rem;
  font-size: 11px;
  color: rgb(113 113 122);
}

.message-body[data-pending="true"] { min-height: 1.5rem; }

.message-pending {
  display: inline-flex; align-items: center; gap: 0.5rem;
  color: rgb(161 161 170);
}

.message-pending__orb {
  width: 0.85rem; height: 0.85rem;
  border-radius: 99px;
  border: 1.5px solid rgb(63 63 70);
  border-top-color: rgb(161 161 170);
  flex-shrink: 0;
  animation: spin 0.9s linear infinite;
}

.message-pending__core { display: none; }

.message-pending__label {
  font-size: 12px; line-height: 1.35; color: rgb(113 113 122);
}

/* ── Typing indicator ────────────────────────────────────────── */

.typing-indicator {
  display: inline-flex; align-items: center; gap: 4px;
}

.typing-indicator span {
  width: 5px; height: 5px; border-radius: 99px;
  background: rgb(113 113 122);
  animation: typing-dot 800ms ease-in-out infinite;
}

.typing-indicator span:nth-child(2) { animation-delay: 120ms; }
.typing-indicator span:nth-child(3) { animation-delay: 240ms; }

body.reduce-motion .typing-indicator span { animation: none; }

/* ── Density & motion ────────────────────────────────────────── */

body[data-ui-density="compact"] { letter-spacing: -0.005em; }
body[data-ui-density="compact"] .message-content { padding: 0.5rem 0.65rem; }

body.reduce-motion *,
body.reduce-motion *::before,
body.reduce-motion *::after {
  animation: none !important;
  transition: none !important;
}

/* ── Link overlay ────────────────────────────────────────────── */

.link-overlay {
  position: fixed;
  inset: 2.5rem 0 0;
  z-index: 280;
  display: flex; flex-direction: column;
  background: rgb(9 9 11 / 0.98);
  overflow: hidden;
  opacity: 0; visibility: hidden; pointer-events: none;
  transition: opacity 200ms ease, visibility 200ms step-end;
}

.link-overlay.hidden { display: none; }

.link-overlay.is-open {
  opacity: 1; visibility: visible; pointer-events: auto;
  transition: opacity 200ms ease, visibility 200ms step-start;
}

.link-overlay.is-closing {
  opacity: 0; visibility: hidden; pointer-events: none;
}

.link-overlay__header {
  display: flex; align-items: center; gap: 8px;
  padding: 8px 12px; min-height: 40px;
  border-bottom: 1px solid rgb(63 63 70 / 0.4);
  background: rgb(18 18 20);
  flex-shrink: 0;
}

.link-overlay.is-open .link-overlay__header { opacity: 1; }

.link-overlay__url {
  flex: 1; min-width: 0;
  font-size: 12px; color: rgb(113 113 122);
  font-family: var(--app-mono-font-stack);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}

.link-overlay__actions { display: flex; align-items: center; gap: 6px; flex-shrink: 0; }

.link-overlay__btn-browser {
  display: inline-flex; align-items: center; gap: 5px;
  padding: 4px 10px; border-radius: 6px;
  border: 1px solid rgb(63 63 70);
  background: rgb(39 39 42 / 0.6);
  font-size: 12px; color: rgb(161 161 170);
  cursor: pointer; transition: background 120ms ease;
}

.link-overlay__btn-browser:hover { background: rgb(63 63 70 / 0.7); }
.link-overlay__btn-browser:active { transform: scale(0.97); }

.link-overlay__btn-close {
  display: grid; place-items: center;
  width: 28px; height: 28px; border-radius: 6px;
  border: 1px solid rgb(63 63 70);
  background: transparent; color: rgb(113 113 122);
  cursor: pointer; transition: background 120ms ease, color 120ms ease;
}

.link-overlay__btn-close:hover { background: rgb(63 63 70 / 0.5); color: rgb(212 212 216); }

.link-overlay__frame {
  flex: 1; width: 100%; border: none; background: #fff;
  opacity: 0; transition: opacity 200ms ease 40ms;
}

.link-overlay.is-open .link-overlay__frame { opacity: 1; }

.link-overlay__fallback {
  position: absolute; inset: 40px 0 0; z-index: 2;
  display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px;
  background: rgb(9 9 11 / 0.98); color: rgb(63 63 70);
}

.link-overlay__fallback.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
.link-overlay__fallback-text { margin: 0; font-size: 13px; color: rgb(113 113 122); text-align: center; }
.link-overlay__fallback-sub { margin: 0; font-size: 11px; color: rgb(63 63 70); text-align: center; font-family: var(--app-mono-font-stack); }

/* ── Model params modal ──────────────────────────────────────── */

.model-params-modal {
  z-index: 176;
}

.model-params-modal__panel {
  position: relative; width: 100%; max-width: 420px;
  max-height: calc(100vh - 5.5rem);
  display: flex; flex-direction: column;
  border-radius: 12px; border: 1px solid rgb(63 63 70);
  background: rgb(18 18 20 / 0.99);
  overflow: hidden;
  opacity: 0;
  transform: translateY(8px);
  transition: transform 200ms ease, opacity 180ms ease;
}

.model-params-modal.is-open .model-params-modal__panel {
  opacity: 1;
  transform: translateY(0);
}

.model-params-modal.is-closing .model-params-modal__panel {
  opacity: 0;
  transform: translateY(4px);
}

.mpm-presets { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 14px; }

.mpm-preset-btn {
  display: inline-flex; align-items: center;
  padding: 3px 10px; border-radius: 6px;
  border: 1px solid rgb(63 63 70);
  background: rgb(39 39 42 / 0.5);
  font-size: 11px; color: rgb(161 161 170);
  cursor: pointer; transition: background 120ms ease, border-color 120ms ease;
}

.mpm-preset-btn:hover { background: rgb(63 63 70 / 0.5); border-color: rgb(82 82 91); }

.mpm-preset-btn.is-active {
  border-color: rgb(139 92 246 / 0.4);
  background: rgb(139 92 246 / 0.1);
  color: rgb(196 181 253);
}

.mpm-fields { display: flex; flex-direction: column; gap: 12px; }

.mpm-field { display: flex; flex-direction: column; gap: 5px; }

.mpm-field__header { display: flex; align-items: center; justify-content: space-between; }

.mpm-field__label {
  font-size: 10px; text-transform: uppercase;
  letter-spacing: 0.1em; color: rgb(113 113 122);
}

.mpm-field__num {
  width: 72px; padding: 3px 8px; border-radius: 6px;
  border: 1px solid rgb(63 63 70);
  background: rgb(24 24 27);
  font-size: 12px; color: rgb(228 228 231);
  text-align: right; outline: none;
}

.mpm-field__num:focus { border-color: rgb(113 113 122); }

.mpm-field__range {
  width: 100%; height: 3px;
  accent-color: rgb(139 92 246);
  cursor: pointer;
}

/* .model-params-modal__header, __title, __close, __body, __footer → Tailwind in HTML */

/* ── Keyframes ───────────────────────────────────────────────── */

@keyframes fade-in {
  from { opacity: 0; }
  to   { opacity: 1; }
}

@keyframes fade-out {
  from { opacity: 1; }
  to   { opacity: 0; }
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

@keyframes loader-indeterminate {
  0%   { width: 20%; transform: translateX(-100%); }
  60%  { width: 50%; transform: translateX(50%); }
  100% { width: 25%; transform: translateX(220%); }
}

@keyframes typing-dot {
  0%, 80%, 100% { opacity: 0.3; transform: translateY(0); }
  40% { opacity: 1; transform: translateY(-2px); }
}

@keyframes slide-in-right {
  from { opacity: 0; transform: translateX(10px); }
  to   { opacity: 1; transform: translateX(0); }
}

@keyframes slide-in-left {
  from { opacity: 0; transform: translateX(-10px); }
  to   { opacity: 1; transform: translateX(0); }
}

/* legacy keyframe aliases for JS references */
@keyframes loader-spin { to { transform: rotate(360deg); } }
@keyframes loader-pulse { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }
@keyframes critical-loader-indeterminate {
  0%   { width: 20%; transform: translateX(-100%); }
  60%  { width: 50%; transform: translateX(50%); }
  100% { width: 25%; transform: translateX(220%); }
}
@keyframes message-rise-in { from { opacity: 0; } to { opacity: 1; } }
@keyframes route-page-enter { from { opacity: 0; } to { opacity: 1; } }
@keyframes settings-section-enter { from { opacity: 0; } to { opacity: 1; } }
@keyframes context-menu-item-in { from { opacity: 0; } to { opacity: 1; } }
@keyframes toast-in { from { opacity: 0; } to { opacity: 1; } }
@keyframes toast-out { from { opacity: 1; } to { opacity: 0; } }
@keyframes message-pending-spin { to { transform: rotate(360deg); } }
@keyframes message-pending-pulse { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
@keyframes onboarding-step-enter-forward { from { opacity: 0; transform: translateX(10px); } to { opacity: 1; transform: translateX(0); } }
@keyframes onboarding-step-enter-back { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
@keyframes session-item-activate { 0%, 100% { transform: none; } 50% { transform: scale(1.005); } }
@keyframes tool-spin { to { transform: rotate(360deg); } }

/* ── Glass panel (minimal fallback — just semi-transparent bg) ── */

.glass-panel {
  background: rgb(18 18 20 / 0.7);
  backdrop-filter: blur(8px);
}
